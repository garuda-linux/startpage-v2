<ng-container *transloco="let t">
  <div class="md:px-10 px-5 max-w-7xl mx-auto">
    <app-title [title]="t('settings.title')"></app-title>
    <p-panel [header]="t('settings.general')">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-5 text-color mt-5">
        <div class="ml-10">
          <p-checkbox
            (ngModelChange)="updateConfig('defaultLinks', $event)"
            [(ngModel)]="defaultLinks"
            [binary]="true"
            id="default-links"
          />
          <label class="ml-2" for="default-links">{{ t('settings.defaultLinksLabel') }}</label>
        </div>
        <div class="ml-10">
          <p-checkbox
            (ngModelChange)="updateConfig('jokesEnabled', $event)"
            [(ngModel)]="jokesEnabled"
            [binary]="true"
            id="jokes-enabled"
          />
          <label class="ml-2" for="jokes-enabled">{{ t('settings.jokesEnabledLabel') }}</label>
        </div>
        <div class="ml-10">
          <p-checkbox
            (ngModelChange)="updateConfig('fitWallpaper', $event)"
            [(ngModel)]="fitWallpaper"
            [binary]="true"
            id="fit-wp"
          />
          <label class="ml-2" for="fit-wp">{{ t('settings.fitWallpaper') }}</label>
        </div>
        <div class="ml-10">
          <p-checkbox
            (ngModelChange)="updateConfig('blurBackground', $event)"
            [(ngModel)]="blurBackground"
            [binary]="true"
            id="blur-bg"
          />
          <label class="ml-2" for="blur-bg">{{ t('settings.blurBackground') }}</label>
        </div>
      </div>

      <div class="md:flex mt-10 mx-auto w-3/4 md:ml-10">
        <p-button
          (click)="downloadSettings()"
          [label]="t('settings.saveSettings')"
          icon="pi pi-download"
          styleClass="w-full"
        >
        </p-button>
        <p-fileupload
          (onSelect)="restoreSettings($event)"
          [chooseLabel]="t('settings.restoreSettings')"
          accept=".json"
          auto
          chooseIcon="pi pi-upload"
          maxFileSize="1000000"
          mode="basic"
          styleClass="block mt-2.5 md:mt-0 md:ml-2.5 w-full"
        >
        </p-fileupload>
      </div>
    </p-panel>

    <p-panel [header]="t('settings.customize')" styleClass="mt-2.5">
      <div class="mt-5 grid grid-cols-1 md:grid-cols-2 gap-5 text-color">
        <div class="flex flex-col gap-2">
          <label for="search-engine">{{ t('settings.searchEngineLabel') }}</label>
          <p-select
            (ngModelChange)="updateConfig('activeSearchEngine', $event)"
            [(ngModel)]="activeSearchEngine"
            [options]="searchEngineMappings"
            fluid
            id="search-engine"
            optionLabel="prettyName"
            optionValue="name"
          />
        </div>

        @if (configService.settings().activeSearchEngine === 'custom') {
          <div class="flex flex-col gap-2">
            <label for="custom-search">{{ t('settings.searchEngineUrl') }}</label>
            <input
              pInputText
              id="custom-search"
              (ngModelChange)="updateConfig('searchEngineUrl', $event)"
              [(ngModel)]="searchEngineUrl"
            />
          </div>
          <div class="flex flex-col gap-2">
            <label for="custom-search-name">{{ t('settings.searchEngineName') }}</label>
            <input
              pInputText
              id="custom-search-name"
              (ngModelChange)="updateConfig('searchEngineName', $event)"
              [(ngModel)]="searchEngineName"
            />
          </div>
        }

        <div class="flex flex-col gap-2">
          <label for="wallpaper">{{ t('settings.wallpaperLabel') }}</label>
          <p-select
            (ngModelChange)="updateConfig('wallpaper', $event)"
            [(ngModel)]="wallpaper"
            [options]="wallpapers"
            fluid
            id="wallpaper"
            optionLabel="name"
            optionValue="url"
          />
        </div>

        @if (configService.settings().wallpaper === 'custom') {
          <div class="flex flex-col gap-2">
            <label for="custom-wallpaper">{{ t('settings.wallpaperCustomLabel') }}</label>
            <input
              pInputText
              id="custom-wallpaper"
              (ngModelChange)="updateConfig('wallpaperUrl', $event)"
              [(ngModel)]="wallpaperUrl"
            />
          </div>
        }

        <div class="flex flex-col gap-2">
          <label for="logo">{{ t('settings.logoLabel') }}</label>
          <p-select
            (ngModelChange)="updateConfig('logo', $event)"
            [(ngModel)]="logo"
            [options]="logos"
            fluid
            id="logo"
            optionLabel="name"
            optionValue="url"
          />
        </div>

        @if (configService.settings().logo === 'custom') {
          <div class="flex flex-col gap-2">
            <label for="custom-logo">{{ t('settings.customLogo') }}</label>
            <input
              pInputText
              id="custom-logo"
              (ngModelChange)="updateConfig('logoUrl', $event)"
              [(ngModel)]="logoUrl"
            />
          </div>
        }

        <div class="flex flex-col gap-2">
          <label for="title">{{ t('settings.customTitle') }}</label>
          <input
            (ngModelChange)="updateConfig('customTitle', $event)"
            [(ngModel)]="customTitle"
            id="title"
            pInputText
          />
        </div>

        <div class="flex flex-col gap-2">
          <label for="name">{{ t('settings.name') }}</label>
          <input (ngModelChange)="updateConfig('username', $event)" [(ngModel)]="username" id="name" pInputText />
        </div>
        <div class="flex flex-col gap-2">
          <label for="welcome">{{ t('settings.welcomeText') }}</label>
          <input
            (ngModelChange)="updateConfig('welcomeText', $event)"
            [(ngModel)]="welcomeText"
            id="welcome"
            pInputText
          />
        </div>
      </div>
    </p-panel>

    <p-panel [header]="t('settings.customLinks')" styleClass="mt-2.5">
      <p-toolbar styleClass="mt-5">
        <ng-template #start>
          <p-button (onClick)="openNew()" [label]="t('settings.addLink')" class="mr-2" icon="pi pi-plus" />
          <p-button
            (onClick)="deleteSelectedLinks()"
            [disabled]="!selectedLinks() || !selectedLinks()?.length"
            [label]="t('settings.deleteLink')"
            icon="pi pi-trash"
            outlined
            severity="danger"
          />
        </ng-template>
      </p-toolbar>

      <p-table
        #linkTable
        (onRowReorder)="onRowReorder($event)"
        [(selection)]="selectedLinks"
        [currentPageReportTemplate]="t('settings.currentPageReport')"
        [globalFilterFields]="['title', 'url', 'icon']"
        [rowsPerPageOptions]="[15, 30]"
        [rows]="15"
        [value]="customLinks()"
        dataKey="id"
        paginator
        reorderableColumns
        rowHover
        showCurrentPageReport
      >
        <ng-template #caption>
          <div class="flex items-center justify-between">
            <h5 [innerText]="t('settings.manageLinks')" class="m-0"></h5>
            <p-iconfield>
              <p-inputicon styleClass="pi pi-search" />
              <input
                #input
                (input)="linkTable.filterGlobal(input.value, 'contains')"
                [placeholder]="t('settings.search')"
                fluid
                pInputText
                type="text"
              />
            </p-iconfield>
          </div>
        </ng-template>

        <ng-template #header>
          <tr>
            <th style="width: 3rem"></th>
            <th pReorderableColumn style="width: 3rem">
              <p-tableHeaderCheckbox />
            </th>
            <th pReorderableColumn pSortableColumn="title">
              {{ t('settings.linkTitle') }}
              <p-sortIcon field="title" />
            </th>
            <th pReorderableColumn pSortableColumn="link">
              {{ t('settings.url') }}
              <p-sortIcon field="link" />
            </th>
            <th pReorderableColumn>
              {{ t('settings.icon') }}
            </th>
            <th pReorderableColumn style="width: 8rem">
              {{ t('settings.actions') }}
            </th>
          </tr>
        </ng-template>
        <ng-template #body let-index="rowIndex" let-link>
          <tr [pReorderableRow]="index">
            <td>
              <span class="pi pi-bars" pReorderableRowHandle></span>
            </td>
            <td>
              <p-tableCheckbox [value]="link" />
            </td>
            <td>{{ link.title }}</td>
            <td>{{ link.link }}</td>
            <td>{{ link.icon }}</td>
            <td>
              <p-button (click)="editLink(link)" class="mr-2" icon="pi pi-pencil" outlined rounded />
              <p-button (click)="deleteLink(link)" icon="pi pi-trash" outlined rounded severity="danger" />
            </td>
          </tr>
        </ng-template>
      </p-table>

      <p-dialog [(visible)]="linkDialog" [header]="t('settings.linkDetails')" modal>
        <ng-template #content>
          <div class="flex flex-col gap-6">
            <div>
              <label class="block font-bold mb-3" for="link-title"> {{ t('settings.title') }}</label>
              <input [(ngModel)]="link().title" fluid id="link-title" pInputText required type="text" />
              <small *ngIf="linkSubmitted() && !link().title" class="text-primary-emphasis-alt">{{
                t('settings.isRequired')
              }}</small>
            </div>
            <div>
              <label class="block font-bold mb-3" for="url"> {{ t('settings.url') }}</label>
              <input [(ngModel)]="link().link" fluid id="url" pInputText required type="text" />
              <small *ngIf="linkSubmitted() && !link().link" class="text-primary-emphasis-alt">{{
                t('settings.isRequired')
              }}</small>
            </div>
            <div>
              <label class="block font-bold mb-3" for="icon"> {{ t('settings.iconLink') }}</label>
              <input [(ngModel)]="link().icon" fluid id="icon" pInputText required type="text" />
              <small *ngIf="linkSubmitted() && !link().icon" class="text-primary-emphasis-alt">{{
                t('settings.isRequired')
              }}</small>
            </div>
          </div>
        </ng-template>

        <ng-template #footer>
          <p-button (click)="hideDialog()" icon="pi pi-times" label="Cancel" text />
          <p-button (click)="saveLink()" icon="pi pi-check" label="Save" />
        </ng-template>
      </p-dialog>

      <p-confirmDialog />
    </p-panel>
  </div>
</ng-container>
